# libtcod makefile
# to build debug version, run make FLAGS=-g
# to build release version, run make FLAGS='-O2 -s'
SRCDIR=src
INCDIR=include

#dependencies
# SDL
SDL_DIR=dependencies/SDL-1.2.12
SDL_FLAGS=-I $(SDL_DIR)/include
SDL_LIBS=-L $(SDL_DIR)/lib/mingw -lSDL.dll

# ZLIB
ZLIB_DIR=dependencies/zlib-1.2.3
ZLIB_FLAGS=-I $(ZLIB_DIR)/include
ZLIB_LIBS=$(ZLIB_DIR)/lib/mingw/libz.a

# PNG
PNG_DIR=dependencies/libpng-1.2.31
PNG_FLAGS=-I $(PNG_DIR)/include
PNG_LIBS=$(PNG_DIR)/lib/mingw/libpng.a

CFLAGS=$(FLAGS) -I$(INCDIR) -I$(INCDIR)/gui $(SDL_FLAGS) $(ZLIB_FLAGS) $(PNG_FLAGS) -Wall -fno-strict-aliasing
CC=mingw32-gcc
CPP=mingw32-g++
.SUFFIXES: .dll .a .o .h .c .hpp .cpp

$(TEMP)/libtcod/gui/%.o : $(SRCDIR)/gui/%.cpp
	$(CPP) $(CFLAGS) -DLIBTCOD_GUI_EXPORTS -o $@ -c $< 
$(TEMP)/libtcod/%.o : $(SRCDIR)/%.cpp
	$(CPP) $(CFLAGS) -DLIBTCOD_EXPORTS -o $@ -c $< 
$(TEMP)/libtcod/%.o : $(SRCDIR)/%.c
	$(CC) $(CFLAGS) -DLIBTCOD_EXPORTS -o $@ -c $< 

LIBOBJS= \
	$(TEMP)/libtcod/bresenham.o \
	$(TEMP)/libtcod/bresenham_c.o \
	$(TEMP)/libtcod/bsp.o \
	$(TEMP)/libtcod/bsp_c.o \
	$(TEMP)/libtcod/console.o \
	$(TEMP)/libtcod/console_c.o \
	$(TEMP)/libtcod/color.o \
	$(TEMP)/libtcod/color_c.o \
	$(TEMP)/libtcod/fov.o \
	$(TEMP)/libtcod/fov_c.o \
	$(TEMP)/libtcod/fov_circular_raycasting.o \
	$(TEMP)/libtcod/fov_diamond_raycasting.o \
	$(TEMP)/libtcod/fov_digital.o \
	$(TEMP)/libtcod/fov_recursive_shadowcasting.o \
	$(TEMP)/libtcod/fov_permissive2.o \
	$(TEMP)/libtcod/fov_restrictive.o \
	$(TEMP)/libtcod/heightmap.o \
	$(TEMP)/libtcod/heightmap_c.o \
	$(TEMP)/libtcod/image.o \
	$(TEMP)/libtcod/image_c.o \
	$(TEMP)/libtcod/lex.o \
	$(TEMP)/libtcod/lex_c.o \
	$(TEMP)/libtcod/list_c.o \
	$(TEMP)/libtcod/mersenne.o \
	$(TEMP)/libtcod/mersenne_c.o \
	$(TEMP)/libtcod/mouse.o \
	$(TEMP)/libtcod/noise.o \
	$(TEMP)/libtcod/noise_c.o \
	$(TEMP)/libtcod/parser_c.o \
	$(TEMP)/libtcod/parser.o \
	$(TEMP)/libtcod/path_c.o \
	$(TEMP)/libtcod/path.o \
	$(TEMP)/libtcod/sys.o \
	$(TEMP)/libtcod/sys_c.o \
	$(TEMP)/libtcod/sys_sdl_c.o \
	$(TEMP)/libtcod/sys_sdl_img_bmp.o \
	$(TEMP)/libtcod/sys_sdl_img_png.o \
	$(TEMP)/libtcod/tree_c.o \
	$(TEMP)/libtcod/wrappers.o \
	$(TEMP)/libtcod/zip_c.o \
	$(TEMP)/libtcod/zip.o

GUIOBJS= \
	$(TEMP)/libtcod/gui/button.o \
	$(TEMP)/libtcod/gui/container.o \
	$(TEMP)/libtcod/gui/flatlist.o \
	$(TEMP)/libtcod/gui/hbox.o \
	$(TEMP)/libtcod/gui/image.o \
	$(TEMP)/libtcod/gui/label.o \
	$(TEMP)/libtcod/gui/radiobutton.o \
	$(TEMP)/libtcod/gui/slider.o \
	$(TEMP)/libtcod/gui/statusbar.o \
	$(TEMP)/libtcod/gui/textbox.o \
	$(TEMP)/libtcod/gui/togglebutton.o \
	$(TEMP)/libtcod/gui/toolbar.o \
	$(TEMP)/libtcod/gui/vbox.o \
	$(TEMP)/libtcod/gui/widget.o

all : $(TEMP)/libtcod libtcod-mingw.dll libtcod-gui-mingw.dll

$(TEMP)/libtcod :
	mkdir -p $@

$(TEMP)/libtcod/gui :
	mkdir -p $@

libtcod-mingw.a : $(LIBOBJS)
	ar r $@ $(LIBOBJS)
	
libtcod-mingw.dll : $(TEMP)/libtcod $(LIBOBJS)
	$(CPP) -mwindows -o $@ -shared -Wl,--out-implib,lib/libtcod-mingw.a $(LIBOBJS) $(ZLIB_LIBS) $(PNG_LIBS) $(SDL_LIBS)

libtcod-gui-mingw.dll : $(TEMP)/libtcod $(TEMP)/libtcod/gui $(GUIOBJS)
	$(CPP) -mwindows -o $@ -shared -Wl,--out-implib,lib/libtcod-gui-mingw.a $(GUIOBJS) -Llib -ltcod-mingw

clean :
	\rm -f $(LIBOBJS) $(GUIOBJS) libtcod-mingw.dll lib/libtcod-mingw.a libtcod-gui-mingw.dll lib/libtcod-gui-mingw.a libtcodpy.pyc

